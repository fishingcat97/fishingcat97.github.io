---
redirect_from: /_posts/2022-04-3-7-CPIU.md
title: 第七章 CPU
tags: 计算机组成原理
---

## 7.1 CPU的结构

### 7.1.1 CPU的功能

1. 控制器的功能

   ​	取指令：要求控制器能自动形成指令的地址,并能发出取指令的命令,将对应此地址的指令取到挖制器中  
   ​	分析指令：其一,分析控制器需发出什么操作命令;其二,分析操作数的有效地址。  
   ​	执行指令：根据分析指令产生的“操作命令”和“操作数地址”的要求,形成操作控制信号序列，执行每条指令  
   ​	控制程序输入及结果的输出 
   ​	总线管理 
   ​	处理异常情况和特殊请求

2. 运算器的功能

### 7.1.2 CPU结构框图

![CPU的结构](/assets/image/计算机组成原理/CPU/CPU的结构.jpg)

### 7.1.3 CPU的寄存器

1. 用户可见寄存器  
   (1). 通用寄存器：存放操作数，可作某种寻址方式所需的专用寄存器  
   (2). 数据寄存器：存放操作数（满足各种数据类型，两个寄存器拼接存放双倍字长数据  
   (3). 地址寄存器：存放地址，其位数应满足最大的地址范围。用于特殊的寻址方式   ，如段基值 、栈指针  
   (4). 条件码寄存器：存放条件码，可作程序分支的依据。如 正、负、零、溢出、进位等  
   
2. 控制和状态寄存器  
   (1). 控制寄存器  
   
   - MAR存储器地址寄存器：用于存放将被访问的存储单元的地址;  
   
   - MDR存储器数据寄存器：用于存放欲存入存储器中的数据或最近从存储器中读出的数据  
   
   - PC程序计数器：存放现行指令的地址,通常具有计数功能。当遇到转移类指令时,PC的值可被修改;  
   
   - IR指令寄存器：存放当前欲执行的指令。  
   
      
   
      PC——>MAR——>MDR——>IR  
   
      
   
   通过这四个寄存器,CPU和主存可交换信息。例如,将现行指令地址从PC送至MAR,启动存储器作读操作,存储器就可将指定地址单元内的指令读至MDR,再由MDR送至IR。  
   
   (2). 状态寄存器
   
   状态寄存器：存放条件码  
   
   PSW 寄存器：存放程序状态字  


## 7.2 指令周期

### 7.2.1 指令周期的基本概念

`指令周期：取出并执行一条指令所需的全部时间`

![指令周期](/assets/image/计算机组成原理/CPU/指令周期.jpg)

- 每条指令的指令周期不同

![不同指令周期](/assets/image/计算机组成原理/CPU/不同指令周期.jpg)

- 具有间接寻址的指令周期

当遇到间接寻址的指令时,由于指令字中只给出操作数有效地址的地址,因此,为了取出操作数,需先访问一次存储器,取出有效地址,然后再访问存储器,取出操作数。这样,间接寻址的指令周期就包括取指周期、间址周期和执行周期三个阶段,其中间址周期用于取操作数的有效地址,因此间址周期介于取指周期和执行周期之间

![具有间接寻址的指令周期](/assets/image/计算机组成原理/CPU/具有间接寻址的指令周期.jpg)

- 带有中断周期的指令周期

当CPU采用中断方式实现主机与I/O交换信息时,CPU在每条指令执行阶段结束前,都要发中断查询信号,以检测是否有某个I/O提出中断请求。如果有请求,CPU则要进入中断响应阶段,又称中断周期

![带有中断周期的指令周期](/assets/image/计算机组成原理/CPU/带有中断周期的指令周期.jpg)

- 指令周期流程

![指令周期流程](/assets/image/计算机组成原理/CPU/指令周期流程.jpg)

- CPU工作周期的标志

    CPU的4个工作周期：    
    取指周期：取指令
    间址周期：取地址
    执行周期：存取操作数或结果
    中断周期：存程序断点

为了区别工作周期,在CPU内可设置四个标志触发器,FE、IND、EX和NT分别对应取指、间址、执行和中断

![CPU工作周期的标志](/assets/image/计算机组成原理/CPU/CPU工作周期的标志.jpg)

### 7.2.2 指令周期的数据流

- 取指周期数据流

PC中存放现行指令的地址,该地址送到MAR并送至地址总线,然后由控制部件CU向存储器发出读命令,使对应MAR所指单元的内容(指令)经数据总线送至MDR,再送至IR,与此同时CU控制PC内容加1,形成下一条指令的地址

![取指周期数据流](/assets/image/计算机组成原理/CPU/取指周期数据流.jpg)

- 间址周期数据流

一旦取指周期结束,CU便检查IR中的内容,以确定其是否有间址操作,如果需间址操作,则MDR中指示形式地址的右N位(记作 Ad( MDR)将被送到MAR,又送至地址总线,此后CU向存储器发读命令,以获取有效地址并存至MDR

![间址周期数据流](/assets/image/计算机组成原理/CPU/间址周期数据流.jpg)

- 执行周期数据流

不同指令的执行周期数据流不同

- 中断周期数据流

由CU把用于保存程序断点的存储器特殊地址(如堆栈指针的内容)送往MAR,并送到地址总线上,同时将PC的内容(程序断点)送到MDR,并命令存储器写,最终使程序断点经数据总线存入存储器。此外,还需将中断服务程序的入口地址送至PC,为下一个指令周期的取指周期作好准备。

![中断周期数据流](/assets/image/计算机组成原理/CPU/中断周期数据流.jpg)

## 7.3 指令流水

### 7.3.1 指令流水原理

- 指令的串行执行

![指令的串行执行](/assets/image/计算机组成原理/CPU/指令的串行执行.jpg)

- 指令的二级流水

![指令的二级流水](/assets/image/计算机组成原理/CPU/指令的二级流水.jpg)

- 影响指令流水效率加倍的因素

(1) 执行时间 > 取指时间

![指令部件缓冲区](/assets/image/计算机组成原理/CPU/指令部件缓冲区.jpg)

(2) 条件转移指令对指令流水的影响

当遇到条件转移指令时,条指令是不可知的,因为必须等到执行阶段结束后,才能获知条件是否成立,从而决定下条指令的地址,造成时间损失

通常为了减少时间损失,采用猜测法,即当条件转移指令从取指阶段进入执行阶段时,指令部件仍按顺序预取下一条指令,这样,如果条件不成立,转移没发生,则没有时间损失;若条件成立,转移发生,则所取的指令必须丢掉并再取新的指令

- 指令的六级流水

![指令的六级流水](/assets/image/计算机组成原理/CPU/指令的六级流水.jpg)

取指(FI)、指令译码(DI)、计算操作数地址(CO)、取操作数(FO)、执行指令(EI)、写操作数(WO)

### 7.3.2 影响指令流水线性能的因素



## 7.4 中断系统